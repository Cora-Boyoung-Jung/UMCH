---
title: "UMCH"
author: "Cora Boyoung Jung, Enoch Mwesigwa, Jordan Severn"
---


```{r setup, include=FALSE}
library(plyr)  ## or dplyr (transform -> mutate) 
require(mosaic)
require(ggformula)
require(tidyverse)
require(s245)
require(DHARMa)
library(reticulate) # for using python
library(reactable) #install.packages("reactable") may need to run once
knitr::opts_chunk$set(echo = TRUE, 
                      error = TRUE,
                      message = FALSE,
                      fig.width = 10, fig.height = 4)

theme_set(theme_minimal(base_size = 12))
```

## Import csv & Change data type
  
```{r}
UMCHdata <- read_csv("https://raw.githubusercontent.com/Cora-Boyoung-Jung/UMCH/main/data/UMCH_p.csv",
                     col_types = cols(Birthdate = col_date(format = "%m/%d/%Y"),
                                      Age = col_integer()))
glimpse(UMCHdata)
```
## Tidying data
  
```{r}
UMCH <- UMCHdata %>% mutate(Status = tolower(Status))
neworder <- c("infant","toddler","two_year", "three_year", "four_year")

UMCH <- arrange(transform(UMCH,
             AgeGroup=factor(AgeGroup,levels=neworder)),AgeGroup)
```

## Statistics in Percentage
```{r, start_stats}
# group and get median of scores in each age group
UMCH_grouped <- UMCHdata %>% 
    select(AgeGroup, PhysicalDevelopment,LanguageDevelopment, Adaptive_SelfHelp,
           Adaptive_SocialEmotional, AcademicAndCognitive, AcademicAndCognitive_Maths,
          AcademicAndCognitive_Literacy) %>%
  group_by(AgeGroup) %>%
  summarise_each(funs(round(mean(., na.rm = TRUE), digits=2))) 

UMCH_grouped <- arrange(transform(UMCH_grouped,
             AgeGroup=factor(AgeGroup,levels=neworder)),AgeGroup)

UMCH_grouped%>%
  knitr::kable()
```

```{r}
#make data with max scores
AgeGroup <- c('infant', 'toddler', 'two_year', 'three_year', 'four_year')
UMCH_max <-  as.data.frame(rbind(c('infant', 28,44,12, 16, NA, NA, NA),
                                 c('toddler', 19,59,9, 13, NA, NA, NA),
                                 c('two_year', 27.5,51,NA, NA, 21.5, NA, NA),
                                 c('three_year', 31,48,NA, NA, 21, NA, NA),
                                 c('four_year', 15, 48,NA, NA, 10, 17, 10 )))

#rename columns
names(UMCH_max)[1] <- "AgeGroup"
names(UMCH_max)[2] <- "PhysicalDevelopment"
names(UMCH_max)[3] <- "LanguageDevelopment"
names(UMCH_max)[4] <- "Adaptive_SelfHelp"
names(UMCH_max)[5] <- "Adaptive_SocialEmotional"
names(UMCH_max)[6] <- "AcademicAndCognitive"
names(UMCH_max)[7] <- "AcademicAndCognitive_Maths"
names(UMCH_max)[8] <- "AcademicAndCognitive_Literacy"

#convert to characters
UMCH_max$PhysicalDevelopment <- as.numeric(UMCH_max$PhysicalDevelopment)
UMCH_max$LanguageDevelopment <- as.numeric(UMCH_max$LanguageDevelopment)
UMCH_max$Adaptive_SelfHelp <- as.numeric(UMCH_max$Adaptive_SelfHelp)
UMCH_max$Adaptive_SocialEmotional <- as.numeric(UMCH_max$Adaptive_SocialEmotional)
UMCH_max$AcademicAndCognitive <-  as.numeric(UMCH_max$AcademicAndCognitive)
UMCH_max$AcademicAndCognitive_Maths <- as.numeric(UMCH_max$AcademicAndCognitive_Maths)
UMCH_max$AcademicAndCognitive_Literacy <- as.numeric(UMCH_max$AcademicAndCognitive_Literacy)
UMCH_max%>%
  knitr::kable()
```

```{r, get_percent_func}
getPercent <- function(list1, list2){
  newList <- vector(mode = "list", length = 5)
  for (i in 1:length(list1)) {
    if(is.na(list1[i]))
    {
      newList[[i]] <- NA
    }
    else
    {
      newList[[i]] <- round( (list1[i] / list2[i] * 100), digits = 2)
    }
  }
  newList
}

```

```{r, calculate_percent}
UMCH_percent <- UMCH_grouped %>% 
    mutate(PhysicalDevelopment= getPercent(UMCH_grouped$PhysicalDevelopment,UMCH_max$PhysicalDevelopment),
           LanguageDevelopment= getPercent(UMCH_grouped$LanguageDevelopment,UMCH_max$LanguageDevelopment),
           Adaptive_SelfHelp= getPercent(UMCH_grouped$Adaptive_SelfHelp,UMCH_max$Adaptive_SelfHelp),
           Adaptive_SocialEmotional= getPercent(UMCH_grouped$Adaptive_SocialEmotional,UMCH_max$Adaptive_SocialEmotional),
           AcademicAndCognitive= getPercent(UMCH_grouped$AcademicAndCognitive,UMCH_max$AcademicAndCognitive),
           AcademicAndCognitive_Maths= getPercent(UMCH_grouped$AcademicAndCognitive_Maths,UMCH_max$AcademicAndCognitive_Maths),
           AcademicAndCognitive_Literacy= getPercent(UMCH_grouped$AcademicAndCognitive_Literacy,UMCH_max$AcademicAndCognitive_Literacy))

reactable(UMCH_percent)
```

````{r}
UMCH_percent_long <- UMCH_percent %>%
  pivot_longer(!AgeGroup, names_to = "Domain", values_to = "Percentage") %>%
  na.omit()

UMCH_percent_long %>%
  knitr::kable()
```

```{r}
ggplot(UMCH_percent_long, aes(x = AgeGroup,  y = Percentage)) +
  geom_bar(stat = "identity", width = 0.75, color = "#2b2b2b", size = 0.05 ) + 
  facet_wrap(~Domain, ncol= 3) +
  labs(title="Average Percentage Scored of Total Possible Points Grouped by AgeGroup and Domain", y="Percent")  +
  theme(
    strip.text.x = element_text(margin = margin(5, 5, 5, 5))
  )

```
## Exploring data set
  
```{r}
head(UMCH)
summary(UMCH)
```



## Graphics

- Which domain in the areas of development is scored the lowest and highest in which age group and overall? 
```{r physical-agegroup}
ggplot(UMCH, aes(x = AgeGroup,  y = PhysicalDevelopment, color = Status)) +
  geom_point() +
  labs(x = "Age Group",
       y = "Physical Development Score",
       title = "Number of Passes and Fails by Physical Development Score") +
  expand_limits(y = 0)
```
```{r language-by-agegroup}
ggplot(UMCH, aes(x = AgeGroup,  y = LanguageDevelopment, color = Status)) +
  geom_point() +
  labs(x = "Age Group",
       y = "Language Development Score",
       title = "Number of Passes and Fails by Language Development Score") +
  expand_limits(y = 0)

```

- How does score vary by age group?  
```{r totalscore-by-agegroup}
gf_histogram(~TotalScore, data=UMCH, fill='#00BFC4', color='black') %>% 
  gf_labs(title="Total Scores by Age Group", x="Total Score", y="Counts") + facet_wrap(~AgeGroup)
```

- How does score vary by gender?  
```{r totalscore-by-gender-and-agegroup}
ggplot(UMCH, aes(x = Gender,  y = TotalScore, fill=Gender)) +
  geom_boxplot() + 
  facet_wrap(~AgeGroup) +
  labs(title="Total Scores by Gender for Each AgeGroup", x="Gender") +
  expand_limits(y = 0)
```


## Statistics in Raw Score
```{r}
UMCH_long <- UMCH %>%
  subset(select = -c(Filename, Birthdate, Age, Gender, TotalScore, Status, Examiner)) %>%
  pivot_longer(!AgeGroup, names_to = "Domain", values_to = "Score") %>%
  na.omit() %>%
  mutate(AgeGroup = as.factor(AgeGroup),
         Domain = as.factor(Domain),
         Score = as.numeric(Score))

UMCH_stat <- UMCH_long %>%
  dplyr::group_by(AgeGroup,Domain) %>%
  dplyr::summarise(Min=min(Score),
                   Max=max(Score),
                   Mean=mean(Score),
                   Median=median(Score))

UMCH_stat %>%
  knitr::kable()
```

```{r max}
ggplot(UMCH_stat, aes(x = AgeGroup,  y = Max, color=Domain)) +
  geom_point() + 
  facet_wrap(~Domain) +
  labs(title="Maximum Score of Children Grouped by AgeGroup and Domain", y="Score") +
  theme(legend.position = "none") +
  expand_limits(y = 0)
```
`
```{r min}
ggplot(UMCH_stat, aes(x = AgeGroup,  y = Min, color=Domain)) +
  geom_point() + 
  facet_wrap(~Domain) +
  labs(title="Mininum Score of Children Grouped by AgeGroup and Domain", y="Score") +
  theme(legend.position = "none") +
  expand_limits(y = 0)
```
```{r mean}
ggplot(UMCH_stat, aes(x = AgeGroup,  y = Mean, color=Domain)) +
  geom_point() + 
  facet_wrap(~Domain) +
  labs(title="Average Score of Children Grouped by AgeGroup and Domain", y="Score") +
  theme(legend.position = "none") +
  expand_limits(y = 0)
```

```{r median}
ggplot(UMCH_stat, aes(x = Domain,  y = Median, color=AgeGroup)) +
  geom_point() + 
  labs(title="Median Score of Children Grouped by AgeGroup and Domain", y="Score") +
  theme(legend.position = "none") +
  expand_limits(y = 0)
```


## TotalScore Model

We used linear regression model because it is used to show/predict the relationship between variables where the response variable is continuous. We can use up to 2 predictors given the size of the data (36/15). We will not add any interaction or random effect due to the size of the dataset. Our predictors will be Age and Gender because all other variables contributes to the Total Score which does not make logical sense to include those.     
Response variable: TotalScore 
Predictor(s): Age, Gender   
Regression model: Linear regression 

```{r}
mod_total <- lm(TotalScore ~ Age + Gender,  
          data = UMCH)  
summary(mod_total)  
```

## Model Assessment

```{r linearity-and-error-variance}
gf_point(resid(mod_total) ~ fitted(mod_total)) %>%
  gf_labs(x = 'Fitted Values', y = 'Residuals')
```

The fitted values vs. the residual plot is used for linearity and error variance. There is no trumpeting present so it passes the error variance condition. However, there is some clustering present and the data points make vertical lines so linearity is a little more iffy on whether or not it passes. 

```{r independence}
acf(resid(mod_total))
```

Looking at the acf plot, the plot passes the independence condition. All the lines are within the dotted lines and the lag at 0 is normal. 

```{r normality}
gf_histogram(~resid(mod_total), bins = 5) %>%
  gf_labs(x = "Residuals")
```

Since the data is limited, the bins need to be limited. The histogram passes the normality condition. 


## Prediction Plot

```{r pred-plot-age}
pred_plot(mod_total, 'Age') %>%
  gf_labs(y = 'Predicted Score',
          title = 'Prediction Plot on Age')
```

```{r pred-plot-gender}
pred_plot(mod_total, 'Gender') %>%
  gf_labs(y = 'Predicted Score',
          title = 'Prediction Plot on Gender')
```

According to the prediction plot for Age, there seems to be a positive trend between the score and age where as age increases, the score also increases. This makes sense because the "pass" score for each age group differs according to the age with lower age having the lowest pass score.  
According to the prediction plot for Gender, it looks like the total score is a little higher for female compared to male. However, the overlapping range is high and the number of children is not the same (21 females and 15 males), so it brings down the reliability score of this data but it is worth noting.  






